# This is the uap configuration file.

destination_path: example-out/2007-Barski_et_al

constants:
    # Genome information goes here:
    ## Complete sequence (FASTA)
    - &genome genomes/animalia/chordata/mammalia/primates/homo_sapiens/hg19
    ## FASTA index
    - &genome_faidx genomes/animalia/chordata/mammalia/primates/homo_sapiens/hg19
    # Mapping indices go here:
    ## 1. Bowtie2
    - &bowtie2_genome_index genomes/animalia/chordata/mammalia/primates/homo_sapiens/hg19/hg19_bowtie2_index/bowtie2_index-hg19_all_chr_UCSC-download-yVv5kTxk/
    ## 2. BWA
    - &bwa_genome_index genomes/animalia/chordata/mammalia/primates/homo_sapiens/hg19
    ## 3. Segemehl
    - &segemehl_genome_index genomes/animalia/chordata/mammalia/primates/homo_sapiens/hg19
    ## Control vs. Treatment information needed for MACS2
    - control: &control-treatment-hash
            None:
               - CTCF
               - H2A.Z
               - H2BK5me1
               - H3K27me1
               - H3K27me2
               - H3K27me3
               - H3K36me1
               - H3K36me3
               - H3K4me1
               - H3K4me2
               - H3K4me3
               - H3K79me1
               - H3K79me2
               - H3K79me3
               - H3K9me1
               - H3K9me2
               - H3K9me3
               - H3R2me1
               - H3R2me2
               - H4K20me1
               - H4K20me3
               - H4R3me2
               - Pol_II

steps:
    ##################
    ## Source steps ##
    ##################

    fastq_source:
        sample_to_files_map:
            CTCF:
               - /data/bioinf/projects/data/tcell/Epigenome-ChIPseq/2007-CD4+_T_Cell_ChIPseq-Barski_et_al/SRR001460_1.fastq
            H2A.Z:
               - /data/bioinf/projects/data/tcell/Epigenome-ChIPseq/2007-CD4+_T_Cell_ChIPseq-Barski_et_al/SRR001442_1.fastq
               - /data/bioinf/projects/data/tcell/Epigenome-ChIPseq/2007-CD4+_T_Cell_ChIPseq-Barski_et_al/SRR001459_1.fastq
            H2BK5me1:
               - /data/bioinf/projects/data/tcell/Epigenome-ChIPseq/2007-CD4+_T_Cell_ChIPseq-Barski_et_al/SRR001401_1.fastq
               - /data/bioinf/projects/data/tcell/Epigenome-ChIPseq/2007-CD4+_T_Cell_ChIPseq-Barski_et_al/SRR001412_1.fastq
               - /data/bioinf/projects/data/tcell/Epigenome-ChIPseq/2007-CD4+_T_Cell_ChIPseq-Barski_et_al/SRR001413_1.fastq
            H3K27me1:
               - /data/bioinf/projects/data/tcell/Epigenome-ChIPseq/2007-CD4+_T_Cell_ChIPseq-Barski_et_al/SRR001438_1.fastq
               - /data/bioinf/projects/data/tcell/Epigenome-ChIPseq/2007-CD4+_T_Cell_ChIPseq-Barski_et_al/SRR001448_1.fastq
               - /data/bioinf/projects/data/tcell/Epigenome-ChIPseq/2007-CD4+_T_Cell_ChIPseq-Barski_et_al/SRR001463_1.fastq
               - /data/bioinf/projects/data/tcell/Epigenome-ChIPseq/2007-CD4+_T_Cell_ChIPseq-Barski_et_al/SRR001464_1.fastq
            H3K27me2:
               - /data/bioinf/projects/data/tcell/Epigenome-ChIPseq/2007-CD4+_T_Cell_ChIPseq-Barski_et_al/SRR001433_1.fastq
               - /data/bioinf/projects/data/tcell/Epigenome-ChIPseq/2007-CD4+_T_Cell_ChIPseq-Barski_et_al/SRR001434_1.fastq
               - /data/bioinf/projects/data/tcell/Epigenome-ChIPseq/2007-CD4+_T_Cell_ChIPseq-Barski_et_al/SRR001435_1.fastq
               - /data/bioinf/projects/data/tcell/Epigenome-ChIPseq/2007-CD4+_T_Cell_ChIPseq-Barski_et_al/SRR001436_1.fastq
            H3K27me3:
               - /data/bioinf/projects/data/tcell/Epigenome-ChIPseq/2007-CD4+_T_Cell_ChIPseq-Barski_et_al/SRR001426_1.fastq
               - /data/bioinf/projects/data/tcell/Epigenome-ChIPseq/2007-CD4+_T_Cell_ChIPseq-Barski_et_al/SRR001427_1.fastq
               - /data/bioinf/projects/data/tcell/Epigenome-ChIPseq/2007-CD4+_T_Cell_ChIPseq-Barski_et_al/SRR001428_1.fastq
               - /data/bioinf/projects/data/tcell/Epigenome-ChIPseq/2007-CD4+_T_Cell_ChIPseq-Barski_et_al/SRR001429_1.fastq
            H3K36me1:
               - /data/bioinf/projects/data/tcell/Epigenome-ChIPseq/2007-CD4+_T_Cell_ChIPseq-Barski_et_al/SRR001397_1.fastq
               - /data/bioinf/projects/data/tcell/Epigenome-ChIPseq/2007-CD4+_T_Cell_ChIPseq-Barski_et_al/SRR001406_1.fastq
               - /data/bioinf/projects/data/tcell/Epigenome-ChIPseq/2007-CD4+_T_Cell_ChIPseq-Barski_et_al/SRR001407_1.fastq
            H3K36me3:
               - /data/bioinf/projects/data/tcell/Epigenome-ChIPseq/2007-CD4+_T_Cell_ChIPseq-Barski_et_al/SRR001392_1.fastq
               - /data/bioinf/projects/data/tcell/Epigenome-ChIPseq/2007-CD4+_T_Cell_ChIPseq-Barski_et_al/SRR001393_1.fastq
               - /data/bioinf/projects/data/tcell/Epigenome-ChIPseq/2007-CD4+_T_Cell_ChIPseq-Barski_et_al/SRR001394_1.fastq
               - /data/bioinf/projects/data/tcell/Epigenome-ChIPseq/2007-CD4+_T_Cell_ChIPseq-Barski_et_al/SRR001450_1.fastq
            H3K4me1:
               - /data/bioinf/projects/data/tcell/Epigenome-ChIPseq/2007-CD4+_T_Cell_ChIPseq-Barski_et_al/SRR001439_1.fastq
               - /data/bioinf/projects/data/tcell/Epigenome-ChIPseq/2007-CD4+_T_Cell_ChIPseq-Barski_et_al/SRR001444_1.fastq
               - /data/bioinf/projects/data/tcell/Epigenome-ChIPseq/2007-CD4+_T_Cell_ChIPseq-Barski_et_al/SRR001445_1.fastq
               - /data/bioinf/projects/data/tcell/Epigenome-ChIPseq/2007-CD4+_T_Cell_ChIPseq-Barski_et_al/SRR001446_1.fastq
            H3K4me2:
               - /data/bioinf/projects/data/tcell/Epigenome-ChIPseq/2007-CD4+_T_Cell_ChIPseq-Barski_et_al/SRR001449_1.fastq
               - /data/bioinf/projects/data/tcell/Epigenome-ChIPseq/2007-CD4+_T_Cell_ChIPseq-Barski_et_al/SRR001465_1.fastq
               - /data/bioinf/projects/data/tcell/Epigenome-ChIPseq/2007-CD4+_T_Cell_ChIPseq-Barski_et_al/SRR001466_1.fastq
            H3K4me3:
               - /data/bioinf/projects/data/tcell/Epigenome-ChIPseq/2007-CD4+_T_Cell_ChIPseq-Barski_et_al/SRR001414_1.fastq
               - /data/bioinf/projects/data/tcell/Epigenome-ChIPseq/2007-CD4+_T_Cell_ChIPseq-Barski_et_al/SRR001419_1.fastq
               - /data/bioinf/projects/data/tcell/Epigenome-ChIPseq/2007-CD4+_T_Cell_ChIPseq-Barski_et_al/SRR001420_1.fastq
               - /data/bioinf/projects/data/tcell/Epigenome-ChIPseq/2007-CD4+_T_Cell_ChIPseq-Barski_et_al/SRR001421_1.fastq
               - /data/bioinf/projects/data/tcell/Epigenome-ChIPseq/2007-CD4+_T_Cell_ChIPseq-Barski_et_al/SRR001430_1.fastq
               - /data/bioinf/projects/data/tcell/Epigenome-ChIPseq/2007-CD4+_T_Cell_ChIPseq-Barski_et_al/SRR001431_1.fastq
               - /data/bioinf/projects/data/tcell/Epigenome-ChIPseq/2007-CD4+_T_Cell_ChIPseq-Barski_et_al/SRR001432_1.fastq
            H3K79me1:
               - /data/bioinf/projects/data/tcell/Epigenome-ChIPseq/2007-CD4+_T_Cell_ChIPseq-Barski_et_al/SRR001398_1.fastq
               - /data/bioinf/projects/data/tcell/Epigenome-ChIPseq/2007-CD4+_T_Cell_ChIPseq-Barski_et_al/SRR001408_1.fastq
               - /data/bioinf/projects/data/tcell/Epigenome-ChIPseq/2007-CD4+_T_Cell_ChIPseq-Barski_et_al/SRR001409_1.fastq
            H3K79me2:
               - /data/bioinf/projects/data/tcell/Epigenome-ChIPseq/2007-CD4+_T_Cell_ChIPseq-Barski_et_al/SRR001410_1.fastq
            H3K79me3:
               - /data/bioinf/projects/data/tcell/Epigenome-ChIPseq/2007-CD4+_T_Cell_ChIPseq-Barski_et_al/SRR001441_1.fastq
               - /data/bioinf/projects/data/tcell/Epigenome-ChIPseq/2007-CD4+_T_Cell_ChIPseq-Barski_et_al/SRR001457_1.fastq
               - /data/bioinf/projects/data/tcell/Epigenome-ChIPseq/2007-CD4+_T_Cell_ChIPseq-Barski_et_al/SRR001458_1.fastq
            H3K9me1:
               - /data/bioinf/projects/data/tcell/Epigenome-ChIPseq/2007-CD4+_T_Cell_ChIPseq-Barski_et_al/SRR001399_1.fastq
               - /data/bioinf/projects/data/tcell/Epigenome-ChIPseq/2007-CD4+_T_Cell_ChIPseq-Barski_et_al/SRR001400_1.fastq
               - /data/bioinf/projects/data/tcell/Epigenome-ChIPseq/2007-CD4+_T_Cell_ChIPseq-Barski_et_al/SRR001454_1.fastq
               - /data/bioinf/projects/data/tcell/Epigenome-ChIPseq/2007-CD4+_T_Cell_ChIPseq-Barski_et_al/SRR001467_1.fastq
            H3K9me2:
               - /data/bioinf/projects/data/tcell/Epigenome-ChIPseq/2007-CD4+_T_Cell_ChIPseq-Barski_et_al/SRR001440_1.fastq
               - /data/bioinf/projects/data/tcell/Epigenome-ChIPseq/2007-CD4+_T_Cell_ChIPseq-Barski_et_al/SRR001455_1.fastq
               - /data/bioinf/projects/data/tcell/Epigenome-ChIPseq/2007-CD4+_T_Cell_ChIPseq-Barski_et_al/SRR001456_1.fastq
            H3K9me3:
               - /data/bioinf/projects/data/tcell/Epigenome-ChIPseq/2007-CD4+_T_Cell_ChIPseq-Barski_et_al/SRR001422_1.fastq
               - /data/bioinf/projects/data/tcell/Epigenome-ChIPseq/2007-CD4+_T_Cell_ChIPseq-Barski_et_al/SRR001423_1.fastq
               - /data/bioinf/projects/data/tcell/Epigenome-ChIPseq/2007-CD4+_T_Cell_ChIPseq-Barski_et_al/SRR001424_1.fastq
               - /data/bioinf/projects/data/tcell/Epigenome-ChIPseq/2007-CD4+_T_Cell_ChIPseq-Barski_et_al/SRR001425_1.fastq
            H3R2me1:
               - /data/bioinf/projects/data/tcell/Epigenome-ChIPseq/2007-CD4+_T_Cell_ChIPseq-Barski_et_al/SRR001395_1.fastq
               - /data/bioinf/projects/data/tcell/Epigenome-ChIPseq/2007-CD4+_T_Cell_ChIPseq-Barski_et_al/SRR001396_1.fastq
               - /data/bioinf/projects/data/tcell/Epigenome-ChIPseq/2007-CD4+_T_Cell_ChIPseq-Barski_et_al/SRR001453_1.fastq
            H3R2me2:
               - /data/bioinf/projects/data/tcell/Epigenome-ChIPseq/2007-CD4+_T_Cell_ChIPseq-Barski_et_al/SRR001411_1.fastq
               - /data/bioinf/projects/data/tcell/Epigenome-ChIPseq/2007-CD4+_T_Cell_ChIPseq-Barski_et_al/SRR001443_1.fastq
            H4K20me1:
               - /data/bioinf/projects/data/tcell/Epigenome-ChIPseq/2007-CD4+_T_Cell_ChIPseq-Barski_et_al/SRR001402_1.fastq
               - /data/bioinf/projects/data/tcell/Epigenome-ChIPseq/2007-CD4+_T_Cell_ChIPseq-Barski_et_al/SRR001403_1.fastq
               - /data/bioinf/projects/data/tcell/Epigenome-ChIPseq/2007-CD4+_T_Cell_ChIPseq-Barski_et_al/SRR001452_1.fastq
            H4K20me3:
               - /data/bioinf/projects/data/tcell/Epigenome-ChIPseq/2007-CD4+_T_Cell_ChIPseq-Barski_et_al/SRR001404_1.fastq
               - /data/bioinf/projects/data/tcell/Epigenome-ChIPseq/2007-CD4+_T_Cell_ChIPseq-Barski_et_al/SRR001405_1.fastq
               - /data/bioinf/projects/data/tcell/Epigenome-ChIPseq/2007-CD4+_T_Cell_ChIPseq-Barski_et_al/SRR001451_1.fastq
            H4R3me2:
               - /data/bioinf/projects/data/tcell/Epigenome-ChIPseq/2007-CD4+_T_Cell_ChIPseq-Barski_et_al/SRR001415_1.fastq
               - /data/bioinf/projects/data/tcell/Epigenome-ChIPseq/2007-CD4+_T_Cell_ChIPseq-Barski_et_al/SRR001416_1.fastq
               - /data/bioinf/projects/data/tcell/Epigenome-ChIPseq/2007-CD4+_T_Cell_ChIPseq-Barski_et_al/SRR001417_1.fastq
               - /data/bioinf/projects/data/tcell/Epigenome-ChIPseq/2007-CD4+_T_Cell_ChIPseq-Barski_et_al/SRR001418_1.fastq
            Pol_II:
               - /data/bioinf/projects/data/tcell/Epigenome-ChIPseq/2007-CD4+_T_Cell_ChIPseq-Barski_et_al/SRR001437_1.fastq
               - /data/bioinf/projects/data/tcell/Epigenome-ChIPseq/2007-CD4+_T_Cell_ChIPseq-Barski_et_al/SRR001447_1.fastq
               - /data/bioinf/projects/data/tcell/Epigenome-ChIPseq/2007-CD4+_T_Cell_ChIPseq-Barski_et_al/SRR001461_1.fastq
               - /data/bioinf/projects/data/tcell/Epigenome-ChIPseq/2007-CD4+_T_Cell_ChIPseq-Barski_et_al/SRR001462_1.fastq
            'Pol II':
               - /data/bioinf/projects/data/tcell/Epigenome-ChIPseq/2007-CD4+_T_Cell_ChIPseq-Barski_et_al/SRR001437_1.fastq
               - /data/bioinf/projects/data/tcell/Epigenome-ChIPseq/2007-CD4+_T_Cell_ChIPseq-Barski_et_al/SRR001447_1.fastq
               - /data/bioinf/projects/data/tcell/Epigenome-ChIPseq/2007-CD4+_T_Cell_ChIPseq-Barski_et_al/SRR001461_1.fastq
               - /data/bioinf/projects/data/tcell/Epigenome-ChIPseq/2007-CD4+_T_Cell_ChIPseq-Barski_et_al/SRR001462_1.fastq
        paired_end: no
        first_read: _1.fastq

    ######################
    ## Processing steps ##
    ######################
        
    merge_fastq_files:
        _depends: fastq_source

    # Quality control of sequencing run
    merge_fastqc (fastqc):
        _depends: merge_fastq_files

    merge_fastx_quality_stats (fastx_quality_stats):
        _depends: merge_fastq_files

    cutadapt:
        _depends: fastq_source
        ## Reading adapters from FASTA file introduced with v1.5
        adapter-file: ./adapter_sequences_Barski_2007.mfa
        use_reverse_complement: False
        adapter-type: -a
        fix_qnames: false

    fix_cutadapt:
        _depends: cutadapt

    fix_cutadapt_fastqc (fastqc):
        _depends: fix_cutadapt

    fix_cutadapt_fastx_quality_stats (fastx_quality_stats):
        _depends: fix_cutadapt

    ## Map reads onto genome ##
    bowtie2:
         _depends: fix_cutadapt
         index: *bowtie2_genome_index
        
    bwa_mem:
         _depends: fix_cutadapt
         index: *bwa_genome_index
        
    segemehl:
        _depends: fix_cutadapt
        genome: *genome
        index: *segemehl_genome_index

    tophat2:
        _depends: fix_cutadapt
        library_type: fr-unstranded
        index: *bowtie2_genome_index
        
    sort_bowtie2 (sam_to_sorted_bam):
        _depends: bowtie2
        genome-faidx: *genome_faidx
        temp-sort-directory: /work/kaempf

    sort_bwa_mem (sam_to_sorted_bam):
        _depends: bwa_mem
        genome-faidx: *genome_faidx
        temp-sort-directory: /work/kaempf

    sort_segemehl (sam_to_sorted_bam):
        _depends: segemehl
        genome-faidx: *genome_faidx
        temp-sort-directory: /work/kaempf

    sort_tophat2 (sam_to_sorted_bam):
        _depends: tophat2
        genome-faidx: *genome_faidx
        temp-sort-directory: /work/kaempf
        
    complexity_curve_bowtie2 (preseq_complexity_curve):
        _depends: sort_bowtie2
        pe: no
        seg_len: 500
        
    complexity_curve_bwa_mem (preseq_complexity_curve):
        _depends: sort_bwa_mem
        pe: no
        seg_len: 500

    complexity_curve_segemehl (preseq_complexity_curve):
        _depends: sort_segemehl
        pe: no
        seg_len: 500

    complexity_curve_tophat2 (preseq_complexity_curve):
        _depends: sort_tophat2
        pe: no
        seg_len: 500
        
    rmdup_bowtie2 (picard_markduplicates):
        _depends: sort_bowtie2

    rmdup_bwa_mem (picard_markduplicates):
        _depends: sort_bwa_mem
        
    rmdup_segemehl (picard_markduplicates):
        _depends: sort_segemehl
        
    rmdup_tophat2 (picard_markduplicates):
        _depends: sort_tophat2
        
    macs2_bowtie2_narrow_peaks (macs2):
        _depends: rmdup_bowtie2
        control: *control-treatment-hash

    macs2_bowtie2_broad_peaks (macs2):
        _depends: rmdup_bowtie2
        broad: yes
        control: *control-treatment-hash

    macs2_bwa_mem_narrow_peaks (macs2):
        _depends: rmdup_bwa_mem
        control: *control-treatment-hash

    macs2_bwa_mem_broad_peaks (macs2):
        _depends: rmdup_bwa_mem
        broad: yes
        control: *control-treatment-hash

    macs2_segemehl_narrow_peaks (macs2):
        _depends: rmdup_segemehl
        control: *control-treatment-hash

    macs2_segemehl_broad_peaks (macs2):
        _depends: rmdup_segemehl
        broad: yes
        control: *control-treatment-hash

    macs2_tophat2_narrow_peaks (macs2):
        _depends: rmdup_tophat2
        control: *control-treatment-hash

    macs2_tophat2_broad_peaks (macs2):
        _depends: rmdup_tophat2
        broad: yes
        control: *control-treatment-hash

tools:
    ##################
    # External Tools #
    ##################

    # URL: https://github.com/arq5x/bedtools2
    bedtools:
        path: bedtools
        get_version: --version
        exit_code: 0

    # URL: http://bowtie-bio.sourceforge.net/bowtie2/index.shtml
    bowtie2:
        path: bowtie2
        get_version: --version
        exit_code: 0

    bwa:
        path: bwa
        get_version: ''
        exit_code: 1

    # URL: https://github.com/marcelm/cutadapt
    cutadapt:
        path: cutadapt
        get_version: --version
        exit_code: 0

    # URL: http://www.bioinformatics.babraham.ac.uk/projects/fastqc/
    fastqc:
        path: fastqc
        get_version: --version
        exit_code: 0

    fastx_quality_stats:
        path: fastx_quality_stats
        get_version: -h
        exit_code: 1

    # URL: https://github.com/taoliu/MACS/
    # Installation via 'pip install MACS2'
    macs2:
        path: macs2
        get_version: --version
        exit_code: 0

    # URL: http://broadinstitute.github.io/picard/
    picard-tools:
        path: picard
        get_version: -h
        exit_code: 1

    # URL: http://zlib.net/pigz/
    pigz: 
        path: pigz
        get_version: --version
        exit_code: 0

    # URL: http://smithlabresearch.org/software/preseq/
    preseq:
        path: preseq
        get_version: ''
        exit_code: 0
    
    # URL: http://www.htslib.org/
    samtools:
        path: samtools
        get_version: ''
        exit_code: 1

    # URL: http://www.bioinf.uni-leipzig.de/Software/segemehl/
    segemehl:
        path: segemehl
        get_version: ''
        exit_code: 255

    # URL: http://ccb.jhu.edu/software/tophat/index.shtml
    tophat2:
        path: tophat2
        get_version: --version
        exit_code: 0

    bedGraphToBigWig:
        path: bedGraphToBigWig
        get_version: ''
        exit_code: 255

    ##################
    # Internal Tools #
    ##################

    fix_cutadapt:
        path: ../tools/fix_cutadapt.py
        get_version: --version
        exit_code: 0

    fix_s2c:
        path: ../tools/fix_s2c.py
        exit_code: 1

    fix_qnames:
        path: ../tools/fix_qnames.py
        exit_code: 0

    mate_pair_strand_switch:
        path: ../tools/mate_pair_strand_switch.py
        get_version: --version 
        exit_code: 0

    remove_reads_segemehl:
        path: ../tools/remove_reads_segemehl.py
        exit_code: 1

    s2c:
        path: ../tools/s2c.py
        get_version: ''
        exit_code: 2

    ##############
    # Unix Tools #
    ##############

    cat:
        path: cat
        get_version: --version
        exit_code: 0

    dd:
        path: dd
        get_version: --version
        exit_code: 0
        
    mkdir:
        path: mkdir
        get_version: --version
        exit_code: 0

    mkfifo:
        path: mkfifo
        get_version: --version
        exit_code: 0

    mv:
        path: mv
        get_version: --version
        exit_code: 0

    tar:
        path: tar
        get_version: --version
        exit_code: 0