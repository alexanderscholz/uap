# This is an example configuration for the analysis of ChIPseq data

destination_path: example-out/ChIP-Seq/

constants:
    # 1.  Genome Information:
    # 1.1 Complete Sequence (FASTA)
    - &genome
        genomes/animalia/chordata/mammalia/primates/homo_sapiens/hg19/hg19_UCSC_complete_genome/hg19_all_chr_UCSC-download-RwaETA3q/hg19_all_chr_UCSC-download.fasta

    # 1.2 FASTA index
    - &genome_faidx 
        genomes/animalia/chordata/mammalia/primates/homo_sapiens/hg19/hg19_samtools_faidx/hg19_all_chr_UCSC-download-B7ceRp9K/hg19_all_chr_UCSC-download.fasta.fai

    # 2.  Mapping Indices:
    # 2.1 Bowtie2
    - &bowtie2_genome_index
        genomes/animalia/chordata/mammalia/primates/homo_sapiens/hg19/hg19_bowtie2_index/bowtie2_index-hg19_all_chr_UCSC-download-yVv5kTxk/bowtie2_index-hg19_all_chr_UCSC-download

    # 3.  Peak Calling 
    # 3.1 Control vs. Treatment Information (for MACS2)
    - control: &control-treatment-hash
        rabbit_IgG:
            - H3K4me1
            - H3K4me3
            - H3K27me3
            - H3K36me3

steps:
    ##################
    ## Source steps ##
    ##################

    fc (run_folder_source):
        path: example-data/IlluminaRunFolder/ChIP-Seq/
        paired_end: yes

    ######################
    ## Processing steps ##
    ######################

    merge_fastq_files:
        _depends: fc

    fastqc:
        _depends: merge_fastq_files

    fastx_quality_stats:
        _depends: merge_fastq_files

    cutadapt:
        _depends: merge_fastq_files
        adapter-R1: AGATCGGAAGAGCACACGTCTGAACTCCAGTCAC
        adapter-R2: AGATCGGAAGAGCGTCGTGTAGGGAAAGAGTGTAGATCTCGGTGGTCGCCGTATCATT
        fix_qnames: false

    cutadapt_fastqc (fastqc):
        _depends: cutadapt

    cutadapt_fastx_quality_stats (fastx_quality_stats):
        _depends: cutadapt

    fix_cutadapt:
        _depends: cutadapt

    fix_cutadapt_fastqc (fastqc):
        _depends: fix_cutadapt

    fix_cutadapt_fastx_quality_stats (fastx_quality_stats):
        _depends: fix_cutadapt

    bowtie2:
        _depends: fix_cutadapt
        index: *bowtie2_genome_index

    sort_bowtie2 (sam_to_sorted_bam):
        _depends: bowtie2
        genome-faidx: *genome_faidx
        temp-sort-dir: /tmp/

    rmdup_bowtie2 (picard_markduplicates):
        _depends: sort_bowtie2

    macs2_bowtie2_narrow_peaks (macs2):
        _depends: rmdup_bowtie2
        broad: no
        control: *control-treatment-hash
        nomodel: yes

    macs2_bowtie2_broad_peaks (macs2):
        _depends: rmdup_bowtie2
        broad: yes
        control: *control-treatment-hash
        nomodel: yes

tools:
    ##################
    # External Tools #
    ##################

    # URL: http://bowtie-bio.sourceforge.net/bowtie2/index.shtml
    bowtie2:
        path: bowtie2
        get_version: '--version'
        exit_code: 0

    # URL: https://github.com/marcelm/cutadapt
    cutadapt:
        path: cutadapt
        get_version: '--version'
        exit_code: 0

    # URL: http://www.bioinformatics.babraham.ac.uk/projects/fastqc/
    fastqc:
        path: fastqc
        get_version: '--version'
        exit_code: 0

    # URL: http://hannonlab.cshl.edu/fastx_toolkit/
    fastx_quality_stats:
        path: fastx_quality_stats
        get_version: '-h'
        exit_code: 1

    # URL: https://github.com/taoliu/MACS/
    # Installation via 'pip install MACS2'
    macs2:
        path: macs2
        get_version: --version
        exit_code: 0

    # URL: http://broadinstitute.github.io/picard/
    picard-tools:
        path: picard-tools
        get_version: '--version'
        exit_code: 0

    # URL: http://zlib.net/pigz/
    pigz:
        path: pigz
        get_version: '--version'
        exit_code: 0

    # URL: http://www.htslib.org/
    samtools:
        path: samtools
        get_version: '--version'
        exit_code: 0

    ##################
    # Internal Tools #
    ##################

    fix_cutadapt:
        path: './../tools/fix_cutadapt.py'
        get_version: ''
        exit_code: 2

    fix_qnames:
        path: './../tools/fix_qnames.py'

    remove_reads_segemehl:
        path: './../tools/remove_reads_segemehl.py'
        exit_code: 1

    ##############
    # Unix Tools #
    ##############

    cat:
        path: cat
        get_version: '--version'
        exit_code: 0

    curl:
        path: curl
        get_version: '--version'
        exit_code: 0

    dd:
        path: dd
        get_version: '--version'
        exit_code: 0

    head:
        path: head
        get_version: '--version'
        exit_code: 0

    grep:
        path: grep
        get_version: '--version'

    mkdir:
        path: mkdir
        get_version: '--version'
        exit_code: 0

    mkfifo:
        path: mkfifo
        get_version: '--version'
        exit_code: 0

    mv:
        path: mv
        get_version: '--version'
        exit_code: 0

    sort:
        path: 'sort'
        get_version: '--version'
        exit_code: 0

    sha1sum:
        path: sha1sum
        get_version: '--version'
        exit_code: 0

    tar:
        path: tar
        get_version: '--version'
        exit_code: 0

    wc:
        path: 'wc'
        get_version: '--version'

