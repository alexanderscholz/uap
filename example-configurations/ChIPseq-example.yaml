# This is the rnaseq-pipeline configuration file.

# This is an example configuration for the analysis of ChIPseq data

destination_path: example-out/ChIPseq/

constants:
    - &genome genomes/bacteria/Mycoplasma_genitalium/Mycoplasma_genitalium.ASM2732v1.fa
    - &genome_faidx genomes/bacteria/Mycoplasma_genitalium/samtools_faidx/M_genitalium_genome-download-e6f7QENG/M_genitalium_genome-download.fasta.fai
    - &segemehl_genome_index genomes/bacteria/Mycoplasma_genitalium/segemehl_index/Mycoplasma_genitalium_genome-download-zgtEpQmV/Mycoplasma_genitalium_genome-download.idx
    - &bowtie2_genome_index genomes/bacteria/Mycoplasma_genitalium/bowtie2_index/Mycoplasma_genitalium_index-download-cMQPtBxs/Mycoplasma_genitalium_index-download
    - &bwa_genome_index 

steps:
    ##################
    ## Source steps ##
    ##################

    fc (run_folder_source):
        path: example-data/IlluminaRunFolder
        paired_end: yes

    ######################
    ## Processing steps ##
    ######################

    merge_fastq_files:
        _depends: fc

    fastqc:
        _depends: merge_fastq_files

    fastx_quality_stats:
        _depends: merge_fastq_files

    cutadapt:
        _depends: merge_fastq_files
        adapter-R1: AGATCGGAAGAGCACACGTCTGAACTCCAGTCAC
        adapter-R2: AGATCGGAAGAGCGTCGTGTAGGGAAAGAGTGTAGATCTCGGTGGTCGCCGTATCATT
        fix_qnames: false

    cutadapt_fastqc (fastqc):
        _depends: cutadapt

    cutadapt_fastx_quality_stats (fastx_quality_stats):
        _depends: cutadapt

    fix_cutadapt:
        _depends: cutadapt
        _volatile: true

    fix_cutadapt_fastqc (fastqc):
        _depends: fix_cutadapt

    fix_cutadapt_fastx_quality_stats (fastx_quality_stats):
        _depends: fix_cutadapt

    bowtie2:
        _depends: fix_cutadapt
        index: *bowtie2_genome_index

    sort_bowtie2 (sam_to_sorted_bam):
        _depends: bowtie2
        genome-faidx: *genome_faidx
        temp-sort-directory: /tmp/

    rmdup_bowtie2 (picard_markduplicates):
        _depends: sort_bowtie2

tools:
    ##################
    # External Tools #
    ##################

    bowtie2:
        path: bowtie2
        get_version: '--version'
        exit_code: 0

    cutadapt:
        path: cutadapt
        get_version: '--version'
        exit_code: 0

    fastqc:
        path: fastqc
        get_version: '--version'
        exit_code: 0

    fastx_quality_stats:
        path: fastx_quality_stats
        get_version: '-h'
        exit_code: 1

    picard-tools:
        path: picard
        get_version: -h
        exit_code: 1

    # URL: http://zlib.net/pigz/
    pigz:
        path: pigz
        get_version: '--version'
        exit_code: 0

    samtools:
        path: samtools
        get_version: '--version'
        exit_code: 0

    ##################
    # Internal Tools #
    ##################

    fix_cutadapt:
        path: './../tools/fix_cutadapt.py'
        get_version: ''
        exit_code: 2

    fix_qnames:
        path: './../tools/fix_qnames.py'

    remove_reads_segemehl:
        path: './../tools/remove_reads_segemehl.py'
        exit_code: 1

    ##############
    # Unix Tools #
    ##############

    cat:
        path: cat
        get_version: '--version'
        exit_code: 0

    curl:
        path: curl
        get_version: '--version'
        exit_code: 0

    dd:
        path: dd
        get_version: '--version'
        exit_code: 0

    head:
        path: head
        get_version: '--version'
        exit_code: 0

    grep:
        path: grep
        get_version: '--version'

    mkdir:
        path: mkdir
        get_version: '--version'
        exit_code: 0

    mkfifo:
        path: mkfifo
        get_version: '--version'
        exit_code: 0

    mv:
        path: mv
        get_version: '--version'
        exit_code: 0

    sort:
        path: 'sort'
        get_version: '--version'
        exit_code: 0

    sha1sum:
        path: sha1sum
        get_version: '--version'
        exit_code: 0

    tar:
        path: tar
        get_version: '--version'
        exit_code: 0

    wc:
        path: 'wc'
        get_version: '--version'

