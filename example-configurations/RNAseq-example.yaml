# This is an example configuration for the analysis of RNAseq data

cluster:
    # example for SLURM grid engine
    # default_submit_options: "--cpus-per-task=#{CORES} --ntasks=1"
    # example for UGE/SGE respectively OGS
    # default_submit_options: "-pe smp #{CORES} -cwd -S /bin/bash -l h_rt=24:00:00 -l h_vmem=6G"
    default_pre_job_command: "echo 'Run Started!'"
    default_post_job_command: "echo 'Rub Finished!'"
    default_job_quota: 5

destination_path: example-out/RNA-Seq/

constants:
    # 1.  Genome Information:
    # 1.1 Complete Sequence (FASTA)
    - &genome
        genomes/animalia/chordata/mammalia/primates/homo_sapiens/hg19/hg19_UCSC_complete_genome/hg19_all_chr_UCSC-all_sequences-e6TqgtS5/hg19_all_chr_UCSC-all_sequences.fasta

    # 1.2 FASTA index
    - &genome_faidx 
        genomes/animalia/chordata/mammalia/primates/homo_sapiens/hg19/hg19_samtools_faidx/hg19_all_chr_UCSC-all_sequences-0wKIqrdr/hg19_all_chr_UCSC-all_sequences.fasta.fai

    # 2.  Mapping Indices:
    # 2.1 Bowtie2
    - &bowtie2_genome_index
        genomes/animalia/chordata/mammalia/primates/homo_sapiens/hg19/hg19_bowtie2_index/bowtie2_index-hg19_all_chr_UCSC-all_sequences-186L7q2e/bowtie2_index-hg19_all_chr_UCSC-all_sequences

    # 2.2 Segemehl
    - &segemehl_genome_index
        genomes/animalia/chordata/mammalia/primates/homo_sapiens/hg19/hg19_segemehl_index/segemehl_index-hg19_all_chr_UCSC-download-s8p1Hh3g/segemehl_index-hg19_all_chr_UCSC-download.idx

    # 3.  Gencode Annotation:
    # 3.1 Version 24
    - &gencode_v24_annotation_gtf
        genomes/animalia/chordata/mammalia/primates/homo_sapiens/gencode/gencode.v24.annotation.gtf

steps:
    fc (run_folder_source):
        path: example-data/IlluminaRunFolder/RNA-Seq/
        paired_end: no

    merge_fastq_files:
      _depends: fc

    fastqc_runs (fastqc):
      _depends: merge_fastq_files

    fastx_quality_stats:
      _depends: merge_fastq_files

    cutadapt:
        _depends: merge_fastq_files
        adapter-R1: AGATCGGAAGAGCACACGTCTGAACTCCAGTCAC
        fix_qnames: true

    cutadapt_fastqc (fastqc):
      _depends: cutadapt

    cutadapt_fastx_quality_stats (fastx_quality_stats):
      _depends: cutadapt

    fix_cutadapt:
        _depends: cutadapt
        _volatile: true

    tophat2:
        _depends: fix_cutadapt
        library_type: fr-secondstrand
        index: *bowtie2_genome_index

    sam_to_sorted_bam_tophat2 (sam_to_sorted_bam):
        _depends: tophat2
        genome-faidx: *genome_faidx
        sort-by-name: true
        temp-sort-dir: '/tmp/'

    count_genes_tophat2 (htseq_count):
        _depends: sam_to_sorted_bam_tophat2
        feature-file: *gencode_v24_annotation_gtf
        order: name
        stranded: 'yes'
        mode: intersection-strict
        type: exon
        idattr: gene_id

    cufflinks_tophat2 (cufflinks):
        _depends: sam_to_sorted_bam_tophat2
        library-type: fr-secondstrand
        mask-file: *gencode_v24_annotation_gtf

# Uncomment the following steps if you created the segemehl genome index
#    segemehl:
#        _depends: fix_cutadapt
#        genome: *genome
#        index: *segemehl_genome_index

#    s2c:
#        _depends: segemehl
#        tmp_dir: /tmp/

#    sam_to_sorted_bam_segemehl (sam_to_sorted_bam):
#        _depends: s2c
#        genome-faidx: *genome_faidx
#        temp-sort-dir: /tmp/

#    count_genes_segemehl (htseq_count):
#        _depends: sam_to_sorted_bam_segemehl
#        feature-file: *gencode_v24_annotation_gtf
#        order: name
#        stranded: 'yes'
#        mode: intersection-strict
#        type: exon
#        idattr: gene_id

#    cufflinks_segemehl (cufflinks):
#        _depends: sam_to_sorted_bam_segemehl
#        library-type: fr-secondstrand
#        mask-file: *gencode_v24_annotation_gtf


tools:
    ##################
    # External Tools #
    ##################

    # URL: http://cufflinks.cbcb.umd.edu/
    cufflinks:
        path: cufflinks
        get_version: --version
        exit_code: 1

    # URL: https://github.com/marcelm/cutadapt
    cutadapt:
        path: cutadapt
        get_version: --version
        exit_code: 0

    # URL: http://www.bioinformatics.babraham.ac.uk/projects/fastqc/
    fastqc:
        path: fastqc
        get_version: --version
        exit_code: 0

    # URL: http://www-huber.embl.de/users/anders/HTSeq/doc/count.html
    htseq-count:
        path: htseq-count
        get_version: -h
        exit_code: 0

    # URL: http://zlib.net/pigz/
    pigz:
        path: pigz
        get_version: --version
        exit_code: 0

    # URL: http://www.htslib.org/
    samtools:
        path: samtools
        get_version: ''
        exit_code: 1

#    # URL: http://www.bioinf.uni-leipzig.de/Software/segemehl/
#    segemehl: 
#        path: segemehl.x
#        get_version: ''
#        exit_code: 255

    # URL: http://ccb.jhu.edu/software/tophat/index.shtml
    tophat2:
        path: tophat2
        get_version: --version
        exit_code: 0

    # URL: http://hannonlab.cshl.edu/fastx_toolkit/
    fastx_quality_stats:
        path: fastx_quality_stats
        get_version: -h
        exit_code: 1

    ##################
    # Internal Tools #
    ##################

    fix_cutadapt:
        path: ../tools/fix_cutadapt.py
        get_version: --version
        exit_code: 0

    fix_s2c:
        path: ../tools/fix_s2c.py
        exit_code: 1

    fix_qnames:
        path: ../tools/fix_qnames.py
        exit_code: 0

    s2c:
        path: ['python', '../tools/s2c.py']
        exit_code: 2

    ##############
    # Unix Tools #
    ##############

    cat:
        path: cat
        get_version: --version
        exit_code: 0

    cp:
        path: 'cp'
        get_version: '--version'
        exit_code: 0

    mkdir:
        path: 'mkdir'
        get_version: '--version'
        exit_code: 0

    mv:
        path: 'mv'
        get_version: '--version'
        exit_code: 0

    dd:
        path: 'dd'
        get_version: '--version'
        exit_code: 0

    mkfifo:
        path: 'mkfifo'
        get_version: '--version'
        exit_code: 0

    tar:
        path: 'tar'
        get_version: '--version'
        exit_code: 0
